{% extends "base.html" %}
{% load static %}

{% block title %}{% if is_edit %}Edit{% else %}Add{% endif %} Product | Custom Admin{% endblock %}

{% block content %}
<style>
  body {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    min-height: 100vh;
    font-family: "Poppins", sans-serif;
    position: relative;
  }
  
  body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
      radial-gradient(circle at 20% 50%, rgba(255, 215, 0, 0.1) 0%, transparent 50%),
      radial-gradient(circle at 80% 80%, rgba(255, 107, 107, 0.1) 0%, transparent 50%),
      radial-gradient(circle at 40% 20%, rgba(78, 205, 196, 0.1) 0%, transparent 50%);
    pointer-events: none;
    z-index: 0;
  }

  .admin-container {
    padding: 30px 0;
    position: relative;
    z-index: 1;
  }

  /* Breadcrumb */
  .breadcrumb-custom {
    background: linear-gradient(135deg, rgba(26, 26, 46, 0.8), rgba(22, 33, 62, 0.8));
    backdrop-filter: blur(20px);
    border-radius: 15px;
    padding: 15px 25px;
    margin-bottom: 20px;
    border: 1px solid rgba(255, 215, 0, 0.3);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
  }

  .breadcrumb-custom a {
    color: #ffd700;
    text-decoration: none;
    transition: all 0.3s ease;
  }

  .breadcrumb-custom a:hover {
    color: #ffed4e;
  }

  .breadcrumb-custom span {
    color: rgba(255,255,255,0.7);
    margin: 0 10px;
  }

  /* Form Card */
  .form-card {
    background: linear-gradient(135deg, rgba(26, 26, 46, 0.8), rgba(22, 33, 62, 0.8));
    backdrop-filter: blur(20px);
    border-radius: 20px;
    padding: 30px;
    border: 1px solid rgba(255, 215, 0, 0.3);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
  }

  .form-card h2 {
    color: #fff;
    font-weight: 700;
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 2px solid rgba(255, 215, 0, 0.3);
  }

  /* Form Inputs */
  .form-label {
    color: rgba(255,255,255,0.9);
    font-weight: 600;
    margin-bottom: 8px;
  }

  .form-control, .form-select {
    background: rgba(0,0,0,0.3);
    border: 1px solid rgba(255, 215, 0, 0.3);
    color: #fff;
    border-radius: 10px;
    padding: 12px 15px;
    transition: all 0.3s ease;
  }

  .form-control:focus, .form-select:focus {
    background: rgba(0,0,0,0.4);
    border-color: #ffd700;
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
    color: #fff;
    outline: none;
  }

  .form-control::placeholder {
    color: rgba(255,255,255,0.4);
  }

  /* File Input */
  .form-control[type="file"] {
    padding: 10px;
  }

  /* Buttons */
  .btn-submit {
    background: linear-gradient(135deg, #ffd700, #ffed4e);
    color: #000;
    border: none;
    padding: 12px 40px;
    border-radius: 10px;
    font-weight: 700;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
  }

  .btn-submit:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(255, 215, 0, 0.5);
    color: #000;
  }

  .btn-cancel {
    background: rgba(244,67,54,0.2);
    color: #f44336;
    border: 1px solid #f44336;
    padding: 12px 40px;
    border-radius: 10px;
    font-weight: 600;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-block;
  }

  .btn-cancel:hover {
    background: #f44336;
    color: #fff;
    transform: translateY(-2px);
  }

  /* Image Preview */
  .image-preview {
    max-width: 300px;
    margin-top: 15px;
    border-radius: 10px;
    border: 2px solid rgba(255, 215, 0, 0.3);
  }

  .image-preview img {
    width: 100%;
    border-radius: 8px;
  }

  /* Required indicator */
  .required {
    color: #ff6f61;
  }
</style>

<div class="admin-container container">
  <!-- Breadcrumb -->
  <div class="breadcrumb-custom">
    <a href="{% url 'admin_dashboard' %}"><i class="bi bi-speedometer2 me-2"></i>Dashboard</a>
    <span>›</span>
    <a href="{% url 'admin_products_list' %}">Products</a>
    <span>›</span>
    <span>{% if is_edit %}Edit{% else %}Add New{% endif %}</span>
  </div>

  <!-- Form Card -->
  <div class="form-card">
    <h2>
      <i class="bi bi-{% if is_edit %}pencil{% else %}plus-circle{% endif %} me-2"></i>
      {% if is_edit %}Edit Product{% else %}Add New Product{% endif %}
    </h2>

    <form method="post" enctype="multipart/form-data" action="">
      {% csrf_token %}

      <div class="row">
        <!-- Product Name -->
        <div class="col-md-6 mb-3">
          <label class="form-label">
            Product Name <span class="required">*</span>
          </label>
          <input 
            type="text" 
            name="name" 
            class="form-control" 
            placeholder="Enter product name"
            value="{% if product %}{{ product.name }}{% endif %}"
            required
          >
        </div>

        <!-- Price -->
        <div class="col-md-6 mb-3">
          <label class="form-label">
            Price (₹) <span class="required">*</span>
          </label>
          <input 
            type="number" 
            name="price" 
            class="form-control" 
            placeholder="0.00"
            step="0.01"
            value="{% if product %}{{ product.price }}{% endif %}"
            required
          >
        </div>

        <!-- Category -->
        <div class="col-md-6 mb-3">
          <label class="form-label">
            Category
          </label>
          <select name="category" class="form-select">
            <option value="">-- Select Category --</option>
            {% for cat in categories %}
            <option value="{{ cat.id }}" {% if product and product.category.id == cat.id %}selected{% endif %}>
              {{ cat.name }}
            </option>
            {% endfor %}
          </select>
        </div>

        <!-- Image -->
        <div class="col-md-6 mb-3">
          <label class="form-label">
            Product Image
          </label>
          <input 
            type="file" 
            name="image" 
            class="form-control" 
            accept="image/*"
            {% if not is_edit %}{% endif %}
          >
          {% if product and product.image %}
          <div class="image-preview mt-3">
            <img src="{{ product.image.url }}" alt="{{ product.name }}">
            <small class="text-light d-block mt-2">Current image (upload new to replace)</small>
          </div>
          {% endif %}
        </div>

        <!-- Description -->
        <div class="col-12 mb-4">
          <label class="form-label">
            Description
          </label>
          <textarea 
            name="description" 
            class="form-control" 
            rows="5"
            placeholder="Enter product description..."
          >{% if product %}{{ product.description }}{% endif %}</textarea>
        </div>

        <!-- Buttons -->
        <div class="col-12">
          <button type="submit" class="btn-submit me-3">
            <i class="bi bi-check-circle me-2"></i>
            {% if is_edit %}Update Product{% else %}Create Product{% endif %}
          </button>
          <a href="{% url 'admin_products_list' %}" class="btn-cancel">
            <i class="bi bi-x-circle me-2"></i>
            Cancel
          </a>
        </div>
      </div>
    </form>
  </div>
</div>

<script>
  // Image preview on file select
  document.querySelector('input[type="file"]').addEventListener('change', function(e) {
    if (e.target.files && e.target.files[0]) {
      const reader = new FileReader();
      reader.onload = function(event) {
        let preview = document.querySelector('.image-preview');
        if (!preview) {
          preview = document.createElement('div');
          preview.className = 'image-preview mt-3';
          e.target.parentElement.appendChild(preview);
        }
        preview.innerHTML = `
          <img src="${event.target.result}" alt="Preview">
          <small class="text-light d-block mt-2">New image preview</small>
        `;
      };
      reader.readAsDataURL(e.target.files[0]);
    }
  });
</script>

{% endblock %}
