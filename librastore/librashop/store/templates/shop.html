{% extends "base.html" %}

{% block title %}
SHOP | LIBRA
{% endblock %}

{% block content %}
<style>
  body { background: #0e0e0e; color: #fff; font-family: "Poppins", sans-serif; }
  .shop-hero { background: linear-gradient(135deg, #ffc107, #ff6f61); padding: 60px 0; }
  .shop-hero h1 { color: #000; font-weight: 800; }
  .filters { background: rgba(255,255,255,0.08); backdrop-filter: blur(12px); border-radius: 16px; padding: 16px; }
  .product-card { background: rgba(255,255,255,0.08); backdrop-filter: blur(12px); border-radius: 14px; overflow: hidden; transition: transform .2s ease, box-shadow .2s ease; border: 1px solid rgba(255,255,255,0.12); }
  .product-card:hover { transform: translateY(-4px); box-shadow: 0 10px 30px rgba(0,0,0,0.4); }
  .product-card img { width: 100%; height: 220px; object-fit: cover; }
  .price { color: #ffc107; font-weight: 700; }
  .btn-view { background: linear-gradient(90deg, #ffc107, #ff6f61); color: #000; border: none; }
  
  /* Wishlist Icon */
  .wishlist-icon {
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 10;
    background: rgba(0,0,0,0.6);
    backdrop-filter: blur(10px);
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    font-size: 1.1rem;
    transition: all 0.3s ease;
    border: 1px solid rgba(255,255,255,0.2);
  }
  .wishlist-icon:hover {
    background: #ffc107;
    color: #000;
    transform: scale(1.1);
    border-color: #ffc107;
  }
  .wishlist-icon i {
    transition: all 0.3s ease;
  }
  .wishlist-icon:hover i {
    transform: scale(1.2);
  }
</style>

<section class="shop-hero">
  <div class="container text-center">
    <h1>Shop All Products</h1>
    <p class="lead">Discover our full catalog</p>
  </div>
</section>

<section class="bg-black py-4">
  <div class="container">
    <!-- Search & Filter Bar -->
    <form class="filters mb-4" method="get" action="{% url 'shop' %}">
      <div class="row g-3 align-items-center">
        <!-- Search Input -->
        <div class="col-12 col-lg-6">
          <div class="input-group">
            <span class="input-group-text bg-dark border-secondary text-warning">
              <i class="bi bi-search"></i>
            </span>
            <input 
              id="shopSearch" 
              class="form-control border-secondary" 
              type="search" 
              placeholder="Search products..." 
              name="q" 
              value="{{ q|default:'' }}" 
            />
          </div>
        </div>
        
        <!-- Sort Dropdown -->
        <div class="col-6 col-lg-3">
          <div class="input-group">
            <span class="input-group-text bg-dark border-secondary text-warning">
              <i class="bi bi-sort-down"></i>
            </span>
            <select id="shopSort" class="form-select border-secondary" name="sort">
              <option value="" {% if not sort %}selected{% endif %}>Sort by</option>
              <option value="price_asc" {% if sort == 'price_asc' %}selected{% endif %}>ðŸ’° Price: Low â†’ High</option>
              <option value="price_desc" {% if sort == 'price_desc' %}selected{% endif %}>ðŸ’° Price: High â†’ Low</option>
              <option value="newest" {% if sort == 'newest' %}selected{% endif %}>ðŸ†• Newest First</option>
              <option value="name_asc" {% if sort == 'name_asc' %}selected{% endif %}>ðŸ”¤ Name: A â†’ Z</option>
              <option value="name_desc" {% if sort == 'name_desc' %}selected{% endif %}>ðŸ”¤ Name: Z â†’ A</option>
            </select>
          </div>
        </div>
        
        <!-- Apply Button -->
        <div class="col-6 col-lg-3">
          <button type="submit" class="btn btn-view w-100 fw-semibold">
            <i class="bi bi-funnel me-2"></i>Apply Filters
          </button>
        </div>
      </div>
      
      <!-- Active Filters Display -->
      {% if q or sort %}
      <div class="mt-3 d-flex flex-wrap gap-2 align-items-center">
        <small class="text-warning fw-semibold">Active Filters:</small>
        {% if q %}
        <span class="badge bg-warning text-dark">
          <i class="bi bi-search me-1"></i>{{ q }}
          <a href="?sort={{ sort }}" class="text-dark ms-1 text-decoration-none">Ã—</a>
        </span>
        {% endif %}
        {% if sort %}
        <span class="badge bg-warning text-dark">
          <i class="bi bi-sort-down me-1"></i>
          {% if sort == 'price_asc' %}Price: Low â†’ High
          {% elif sort == 'price_desc' %}Price: High â†’ Low
          {% elif sort == 'newest' %}Newest First
          {% elif sort == 'name_asc' %}Name: A â†’ Z
          {% elif sort == 'name_desc' %}Name: Z â†’ A
          {% endif %}
          <a href="?q={{ q }}" class="text-dark ms-1 text-decoration-none">Ã—</a>
        </span>
        {% endif %}
        <a href="{% url 'shop' %}" class="badge bg-secondary text-white text-decoration-none">
          <i class="bi bi-x-circle me-1"></i>Clear All
        </a>
      </div>
      {% endif %}
    </form>
    <div class="row g-4">
      {% for product in products %}
      <div class="col-sm-6 col-md-4 col-lg-3">
        <div class="product-card h-100 position-relative">
          <!-- Wishlist Icon -->
          <a href="{% url 'add_to_wishlist' product.id %}" class="wishlist-icon">
            <i class="bi bi-heart"></i>
          </a>
          
          {% if product.image %}
            <img loading="lazy" src="{{ product.image.url }}" alt="{{ product.name }}">
          {% endif %}
          <div class="p-3 text-center">
            <h5 class="mb-1">{{ product.name }}</h5>
            <div class="price mb-2">â‚¹{{ product.price }}</div>
            <a href="{% url 'product_details_by_id' product.id %}" class="btn btn-view btn-sm">View</a>
          </div>
        </div>
      </div>
      {% empty %}
        <p class="text-center text-light">No products found.</p>
      {% endfor %}
    </div>
  </div>
</section>

<script>
  // Debounce helper
  function debounce(fn, delay){ let t; return function(){ clearTimeout(t); t = setTimeout(()=>fn.apply(this, arguments), delay); } }
  const search = document.getElementById('shopSearch');
  const sortSel = document.getElementById('shopSort');
  const form = search ? search.closest('form') : null;
  if (form && search) {
    search.addEventListener('input', debounce(function(){ form.requestSubmit(); }, 400));
  }
  if (form && sortSel) {
    sortSel.addEventListener('change', function(){ form.requestSubmit(); });
  }
</script>
{% endblock %}
