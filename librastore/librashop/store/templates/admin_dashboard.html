{% extends "base.html" %}
{% load static %}

{% block title %}Admin Dashboard | LIBRA{% endblock %}

{% block content %}
<style>
  body {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    min-height: 100vh;
    font-family: "Poppins", sans-serif;
    position: relative;
  }
  
  body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
      radial-gradient(circle at 20% 50%, rgba(255, 215, 0, 0.1) 0%, transparent 50%),
      radial-gradient(circle at 80% 80%, rgba(255, 107, 107, 0.1) 0%, transparent 50%),
      radial-gradient(circle at 40% 20%, rgba(78, 205, 196, 0.1) 0%, transparent 50%);
    pointer-events: none;
    z-index: 0;
  }
  
  .dashboard-container {
    position: relative;
    z-index: 1;
  }

  .dashboard-container {
    padding: 30px 0;
  }

  /* Header */
  .dashboard-header {
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(20px);
    border-radius: 20px;
    padding: 30px;
    margin-bottom: 30px;
    border: 1px solid rgba(255,255,255,0.2);
  }

  .dashboard-header h1 {
    color: #fff;
    font-weight: 700;
    margin: 0;
  }

  .dashboard-header p {
    color: rgba(255,255,255,0.8);
    margin: 5px 0 0 0;
  }

  /* Stats Cards */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }

  .stat-card {
    background: linear-gradient(135deg, rgba(26, 26, 46, 0.8), rgba(22, 33, 62, 0.8));
    backdrop-filter: blur(20px);
    border-radius: 20px;
    padding: 25px;
    border: 1px solid rgba(255, 215, 0, 0.3);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
  }

  .stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #ffd700, #ffed4e, #ffd700);
    box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
  }

  .stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 40px rgba(255, 215, 0, 0.2), 0 0 20px rgba(255, 215, 0, 0.1);
    border-color: rgba(255, 215, 0, 0.6);
  }

  .stat-icon {
    font-size: 2.5rem;
    margin-bottom: 10px;
  }

  .stat-value {
    font-size: 2rem;
    font-weight: 700;
    background: linear-gradient(135deg, #ffd700, #ffed4e);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin: 10px 0;
    filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.3));
  }

  .stat-label {
    color: rgba(255,255,255,0.8);
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  /* Chart Cards */
  .chart-card {
    background: linear-gradient(135deg, rgba(26, 26, 46, 0.8), rgba(22, 33, 62, 0.8));
    backdrop-filter: blur(20px);
    border-radius: 20px;
    padding: 25px;
    margin-bottom: 30px;
    border: 1px solid rgba(255, 215, 0, 0.2);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
  }

  .chart-card h3 {
    color: #fff;
    font-weight: 600;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  /* Product Lists */
  .product-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .product-item {
    background: rgba(255,255,255,0.05);
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.3s ease;
    border: 1px solid rgba(255,255,255,0.1);
  }

  .product-item:hover {
    background: rgba(255,255,255,0.1);
    transform: translateX(5px);
  }

  .product-name {
    color: #fff;
    font-weight: 500;
    flex: 1;
  }

  .product-stat {
    background: linear-gradient(135deg, #ffd700, #ffed4e);
    color: #000;
    padding: 5px 15px;
    border-radius: 20px;
    font-weight: 700;
    font-size: 0.9rem;
    box-shadow: 0 2px 10px rgba(255, 215, 0, 0.3);
    border: 1px solid rgba(255, 215, 0, 0.5);
  }

  /* Bar Chart */
  .bar-chart {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }

  .bar-item {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .bar-label {
    color: #fff;
    min-width: 150px;
    font-weight: 500;
  }

  .bar-container {
    flex: 1;
    background: rgba(255,255,255,0.1);
    border-radius: 10px;
    height: 30px;
    position: relative;
    overflow: hidden;
  }

  .bar-fill {
    height: 100%;
    background: linear-gradient(90deg, #ffd700, #ffed4e, #ffd700);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 10px;
    transition: width 1s ease;
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
  }

  .bar-value {
    color: #000;
    font-weight: 700;
    font-size: 0.85rem;
    text-shadow: 0 1px 2px rgba(255, 255, 255, 0.3);
  }

  /* Orders Table */
  .orders-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0 10px;
  }

  .orders-table thead th {
    color: rgba(255,255,255,0.7);
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.85rem;
    padding: 10px;
    text-align: left;
  }

  .orders-table tbody tr {
    background: rgba(255,255,255,0.05);
    transition: all 0.3s ease;
  }

  .orders-table tbody tr:hover {
    background: rgba(255,255,255,0.1);
    transform: scale(1.02);
  }

  .orders-table tbody td {
    padding: 15px 10px;
    color: #fff;
    border-top: 1px solid rgba(255,255,255,0.1);
    border-bottom: 1px solid rgba(255,255,255,0.1);
  }

  .orders-table tbody td:first-child {
    border-left: 1px solid rgba(255,255,255,0.1);
    border-radius: 10px 0 0 10px;
  }

  .orders-table tbody td:last-child {
    border-right: 1px solid rgba(255,255,255,0.1);
    border-radius: 0 10px 10px 0;
  }

  .status-badge {
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
  }

  .status-complete {
    background: #4caf50;
    color: #fff;
  }

  .status-pending {
    background: #ff9800;
    color: #fff;
  }

  /* Quick Actions */
  .quick-actions {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
  }

  .action-btn {
    background: linear-gradient(135deg, rgba(26, 26, 46, 0.6), rgba(22, 33, 62, 0.6));
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 215, 0, 0.3);
    border-radius: 15px;
    padding: 20px;
    color: #fff;
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 15px;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
  }

  .action-btn:hover {
    background: linear-gradient(135deg, #ffd700, #ffed4e);
    color: #000;
    transform: translateY(-3px);
    box-shadow: 0 10px 30px rgba(255, 215, 0, 0.4), 0 0 20px rgba(255, 215, 0, 0.2);
    border-color: #ffd700;
  }

  .action-icon {
    font-size: 2rem;
  }

  .action-text {
    font-weight: 600;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .stats-grid {
      grid-template-columns: 1fr;
    }
    
    .bar-label {
      min-width: 100px;
      font-size: 0.85rem;
    }
    
    .orders-table {
      font-size: 0.85rem;
    }
  }

  /* Animation */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .stat-card, .chart-card {
    animation: fadeInUp 0.6s ease forwards;
  }

  .stat-card:nth-child(1) { animation-delay: 0.1s; }
  .stat-card:nth-child(2) { animation-delay: 0.2s; }
  .stat-card:nth-child(3) { animation-delay: 0.3s; }
  .stat-card:nth-child(4) { animation-delay: 0.4s; }
</style>

<div class="dashboard-container container">
  <!-- Header -->
  <div class="dashboard-header">
    <h1><i class="bi bi-speedometer2 me-2"></i>Admin Dashboard</h1>
    <p>Welcome back! Here's what's happening with your store today.</p>
  </div>

  <!-- Charts Section (moved to top) -->
  <div class="row g-3">
    <div class="col-12 col-lg-6">
      <div class="chart-card">
        <h3><i class="bi bi-graph-up"></i> Orders (Last 7 Days)</h3>
        <canvas id="ordersChart" height="150"></canvas>
      </div>
    </div>
    <div class="col-12 col-lg-6">
      <div class="chart-card">
        <h3><i class="bi bi-currency-rupee"></i> Revenue (Last 7 Days)</h3>
        <canvas id="revenueChart" height="150"></canvas>
      </div>
    </div>

    <div class="col-12">
      <div class="chart-card">
        <h3><i class="bi bi-diagram-3"></i> Top Categories</h3>
        <canvas id="topCategoriesChart" height="120"></canvas>
      </div>
    </div>

    <div class="col-12 col-lg-4">
      <div class="chart-card">
        <h3><i class="bi bi-pie-chart"></i> Order Status</h3>
        <canvas id="statusChart" height="220"></canvas>
      </div>
    </div>
    <div class="col-12 col-lg-4">
      <div class="chart-card">
        <h3><i class="bi bi-ticket-perforated"></i> Coupon Usage</h3>
        <canvas id="couponChart" height="220"></canvas>
      </div>
    </div>
    <div class="col-12 col-lg-4">
      <div class="chart-card">
        <h3><i class="bi bi-stars"></i> Top Products</h3>
        <canvas id="topProductsChart" height="220"></canvas>
      </div>
    </div>
  </div>

  <!-- Stats Grid -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon">üì¶</div>
      <div class="stat-value">{{ total_products }}</div>
      <div class="stat-label">Total Products</div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">üõí</div>
      <div class="stat-value">{{ total_orders }}</div>
      <div class="stat-label">Total Orders</div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">üë•</div>
      <div class="stat-value">{{ total_customers }}</div>
      <div class="stat-label">Total Customers</div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">üí∞</div>
      <div class="stat-value">‚Çπ{{ total_revenue|floatformat:0 }}</div>
      <div class="stat-label">Total Revenue</div>
    </div>
  </div>

  <!-- Quick Actions (Consolidated) -->
  <div class="chart-card">
    <h3><i class="bi bi-lightning-fill"></i>Quick Actions</h3>
    <div class="quick-actions">
      <a href="{% url 'admin_products_list' %}" class="action-btn"><span class="action-icon">üì¶</span><span class="action-text">Products</span></a>
      <a href="{% url 'admin_product_add' %}" class="action-btn"><span class="action-icon">‚ûï</span><span class="action-text">Add Product</span></a>
      <a href="{% url 'admin_categories_list' %}" class="action-btn"><span class="action-icon">üìÅ</span><span class="action-text">Categories</span></a>
      <a href="{% url 'admin_category_add' %}" class="action-btn"><span class="action-icon">üÜï</span><span class="action-text">Add Category</span></a>
      <a href="{% url 'admin_orders_list' %}" class="action-btn"><span class="action-icon">üõí</span><span class="action-text">Orders</span></a>
      <a href="{% url 'admin_customers_list' %}" class="action-btn"><span class="action-icon">üë•</span><span class="action-text">Customers</span></a>
      <a href="{% url 'admin_coupons_list' %}" class="action-btn"><span class="action-icon">üéüÔ∏è</span><span class="action-text">Coupons</span></a>
      <a href="{% url 'admin_coupon_add' %}" class="action-btn"><span class="action-icon">üéÅ</span><span class="action-text">Add Coupon</span></a>
    </div>
  </div>

  

  <div class="row">
    <!-- Top Selling Products -->
    <div class="col-md-6">
      <div class="chart-card">
        <h3><i class="bi bi-graph-up-arrow"></i>Top Selling Products</h3>
        <ul class="product-list">
          {% for product in top_products %}
          <li class="product-item">
            <span class="product-name">{{ product.product__name }}</span>
            <span class="product-stat">{{ product.total_sold }} sold</span>
          </li>
          {% empty %}
          <li class="product-item">
            <span class="product-name" style="opacity: 0.5;">No sales data yet</span>
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>

    <!-- Low Selling Products -->
    <div class="col-md-6">
      <div class="chart-card">
        <h3><i class="bi bi-graph-down-arrow"></i>Low Selling Products</h3>
        <ul class="product-list">
          {% for product_id, data in low_selling %}
          <li class="product-item">
            <span class="product-name">{{ data.name }}</span>
            <span class="product-stat" style="background: linear-gradient(135deg, #ff6f61, #ffc107);">{{ data.sold }} sold</span>
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>

  <!-- Category Performance removed to reduce clutter -->

  <!-- Recent Orders -->
  <div class="chart-card">
    <h3><i class="bi bi-clock-history"></i>Recent Orders</h3>
    <div class="table-responsive">
      <table class="orders-table">
        <thead>
          <tr>
            <th>Order ID</th>
            <th>Customer</th>
            <th>Date</th>
            <th>Status</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
          {% for order in recent_orders %}
          <tr>
            <td>#{{ order.id }}</td>
            <td>{{ order.customer.name }}</td>
            <td>{{ order.date_odered|date:"M d, Y" }}</td>
            <td>
              {% if order.complete %}
              <span class="status-badge status-complete">Complete</span>
              {% else %}
              <span class="status-badge status-pending">Pending</span>
              {% endif %}
            </td>
            <td>‚Çπ{{ order.get_cart_total|floatformat:0 }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="5" style="text-align: center; opacity: 0.5;">No orders yet</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
  const accent1 = '#ffc107';
  const accent2 = '#ff6f61';
  const text1 = '#fff';
  const gridColor = 'rgba(255,255,255,0.15)';

  const ordersCtx = document.getElementById('ordersChart');
  const revenueCtx = document.getElementById('revenueChart');
  const topCatCtx = document.getElementById('topCategoriesChart');

  if (ordersCtx) new Chart(ordersCtx, {
    type: 'line',
    data: { labels: {{ orders_labels|safe }}, datasets: [{ label: 'Orders', data: {{ orders_counts|safe }}, borderColor: accent1, backgroundColor: 'rgba(255,193,7,0.25)', tension: 0.35, fill: true, pointRadius: 3, pointBackgroundColor: accent1 }] },
    options: { responsive: true, plugins: { legend: { labels: { color: text1 } } }, scales: { x: { ticks: { color: text1 }, grid: { color: gridColor } }, y: { ticks: { color: text1 }, grid: { color: gridColor } } } }
  });

  if (revenueCtx) new Chart(revenueCtx, {
    type: 'line',
    data: { labels: {{ revenue_labels|safe }}, datasets: [{ label: 'Revenue (‚Çπ)', data: {{ revenue_values|safe }}, borderColor: accent2, backgroundColor: 'rgba(255,111,97,0.25)', tension: 0.35, fill: true, pointRadius: 3, pointBackgroundColor: accent2 }] },
    options: { responsive: true, plugins: { legend: { labels: { color: text1 } } }, scales: { x: { ticks: { color: text1 }, grid: { color: gridColor } }, y: { ticks: { color: text1 }, grid: { color: gridColor } } } }
  });

  if (topCatCtx) new Chart(topCatCtx, {
    type: 'bar',
    data: { labels: {{ top_cat_labels|safe }}, datasets: [{ label: 'Products', data: {{ top_cat_counts|safe }}, backgroundColor: [accent1, accent2, 'rgba(255,193,7,0.65)', 'rgba(255,111,97,0.65)', 'rgba(255,193,7,0.35)'], borderColor: 'transparent', borderRadius: 8 }] },
    options: { responsive: true, plugins: { legend: { labels: { color: text1 } } }, scales: { x: { ticks: { color: text1 }, grid: { color: gridColor } }, y: { ticks: { color: text1 }, grid: { color: gridColor } } } }
  });

  const statusCtx = document.getElementById('statusChart');
  if (statusCtx) new Chart(statusCtx, { type: 'doughnut', data: { labels: {{ status_labels|safe }}, datasets: [{ data: {{ status_counts|safe }}, backgroundColor: ['rgba(34,197,94,0.65)','rgba(255,193,7,0.7)','rgba(239,68,68,0.7)','rgba(59,130,246,0.7)'], borderColor: 'transparent' }] }, options: { plugins: { legend: { labels: { color: text1 } } } } });

  const couponCtx = document.getElementById('couponChart');
  if (couponCtx) new Chart(couponCtx, { type: 'bar', data: { labels: {{ coupon_labels|safe }}, datasets: [{ label: 'Uses', data: {{ coupon_counts|safe }}, backgroundColor: 'rgba(255,193,7,0.6)', borderColor: 'transparent', borderRadius: 8 }] }, options: { plugins: { legend: { labels: { color: text1 } } }, scales: { x: { ticks: { color: text1 }, grid: { color: gridColor } }, y: { ticks: { color: text1 }, grid: { color: gridColor } } } } });

  const topProdCtx = document.getElementById('topProductsChart');
  if (topProdCtx) new Chart(topProdCtx, { type: 'bar', data: { labels: {{ top_prod_labels|safe }}, datasets: [{ label: 'Qty', data: {{ top_prod_counts|safe }}, backgroundColor: 'rgba(255,111,97,0.6)', borderColor: 'transparent', borderRadius: 8 }] }, options: { indexAxis: 'y', plugins: { legend: { labels: { color: text1 } } }, scales: { x: { ticks: { color: text1 }, grid: { color: gridColor } }, y: { ticks: { color: text1 }, grid: { color: gridColor } } } } });
</script>
<script>
  // Animate bars on load
  window.addEventListener('load', function() {
    const bars = document.querySelectorAll('.bar-fill');
    bars.forEach(bar => {
      const width = bar.style.width;
      bar.style.width = '0%';
      setTimeout(() => {
        bar.style.width = width;
      }, 100);
    });
  });
</script>

{% endblock %}
