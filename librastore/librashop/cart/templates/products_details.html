{% extends 'base.html' %}
{% load static %}
{% block title %}{{ product.name }} | LIBRA{% endblock %}
{% block content %}

<style>
  body {
    background-color: #0e0e0e;
    color: #fff;
    font-family: "Poppins", sans-serif;
  }

  .product-container {
    margin-top: 120px;
    padding: 40px 20px;
  }

  .product-card {
    background: rgba(255, 255, 255, 0.07);
    backdrop-filter: blur(20px);
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
  }

  .product-image {
    border-radius: 20px;
    overflow: hidden;
    position: relative;
  }

  .wishlist-icon-overlay {
    position: absolute;
    top: 15px;
    left: 15px;
    z-index: 10;
  }

  .wishlist-icon-overlay button {
    background: rgba(255, 255, 255, 0.95);
    border: none;
    border-radius: 50%;
    width: 45px;
    height: 45px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  }

  .wishlist-icon-overlay button i {
    color: #ff6f61;
    font-size: 1.3rem;
  }

  .wishlist-icon-overlay button:hover {
    background: #ffc107;
    transform: scale(1.15);
    box-shadow: 0 6px 18px rgba(255,193,7,0.5);
  }

  .product-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.4s ease;
  }

  .product-image img:hover {
    transform: scale(1.05);
  }

  .product-name {
    font-size: 2rem;
    font-weight: 700;
    color: #ffc107;
  }

  .product-price {
    font-size: 1.6rem;
    font-weight: 600;
    color: #ff6f61;
  }

  .rating {
    color: #ffc107;
    font-size: 1.2rem;
  }

  .product-description {
    margin-top: 15px;
    color: rgba(255,255,255,0.85);
    line-height: 1.7;
  }

  .action-buttons {
    margin-top: 25px;
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
  }

  .btn-glow {
    background: linear-gradient(90deg, #ffc107, #ff6f61);
    border: none;
    color: #000;
    font-weight: 600;
    border-radius: 50px;
    padding: 12px 30px;
    transition: all 0.3s ease;
  }

  .btn-glow:hover {
    transform: scale(1.05);
    box-shadow: 0 0 20px rgba(255,193,7,0.6);
  }

  .btn-outline {
    border: 2px solid #ffc107;
    background: transparent;
    color: #ffc107;
    font-weight: 600;
    border-radius: 50px;
    padding: 12px 30px;
    transition: all 0.3s ease;
  }

  .btn-outline:hover {
    background: linear-gradient(90deg, #ffc107, #ff6f61);
    color: #000;
    border: none;
    transform: scale(1.05);
  }

  .similar-products {
    margin-top: 80px;
  }

  .similar-products h3 {
    color: #ffc107;
    margin-bottom: 30px;
  }

  .product-card-mini {
    background: rgba(255, 255, 255, 0.08);
    backdrop-filter: blur(15px);
    border-radius: 15px;
    text-align: center;
    padding: 15px;
    transition: 0.3s;
  }

  .product-card-mini:hover {
    box-shadow: 0 0 15px rgba(255,193,7,0.5);
    transform: translateY(-5px);
  }

  .product-card-mini img {
    width: 100%;
    height: 180px;
    object-fit: cover;
    border-radius: 10px;
    margin-bottom: 10px;
  }

  .product-card-mini h6 {
    color: #ffc107;
  }

  .product-card-mini p {
    color: #ff6f61;
    font-weight: 500;
  }
</style>

<div class="container product-container">
  <div class="row g-4 align-items-center">
    <!-- Product Images (Gallery) -->
    <div class="col-lg-6">
      <div class="product-image">
        {% with main_image=product.image %}
          {% if images and images|length > 0 %}
            <img src="{{ images.0.image.url }}" alt="{{ images.0.alt_text|default:product.name }}" id="mainProductImage">
          {% elif main_image %}
            <img src="{{ main_image.url }}" alt="{{ product.name }}" id="mainProductImage">
          {% else %}
            <img src="{% static 'img/placeholder.png' %}" alt="No image" id="mainProductImage">
          {% endif %}
        {% endwith %}

        <!-- Wishlist Icon Overlay -->
        {% if user.is_authenticated %}
        <div class="wishlist-icon-overlay">
          <form method="post" action="{% url 'add_to_wishlist' product.id %}">
            {% csrf_token %}
            <button type="submit" title="Add to Wishlist">
              <i class="bi bi-heart-fill"></i>
            </button>
          </form>
        </div>
        {% endif %}
      </div>

      {% if images and images|length > 1 %}
      <div class="mt-3 d-flex gap-2 flex-wrap">
        {% for gi in images %}
          <img src="{{ gi.image.url }}" alt="{{ gi.alt_text|default:product.name }}" style="width:80px;height:80px;object-fit:cover;border-radius:8px;border:1px solid rgba(255,255,255,0.2);cursor:pointer;" onclick="document.getElementById('mainProductImage').src='{{ gi.image.url }}'">
        {% endfor %}
      </div>
      {% endif %}
    </div>

    <!-- Product Details -->
    <div class="col-lg-6">
      <div class="product-card">
        <h2 class="product-name">{{ product.name }}</h2>
        <div class="rating mb-2">
          {% for i in "12345" %}
            {% if i|add:"0" <= product.rating %}
              <i class="bi bi-star-fill"></i>
            {% else %}
              <i class="bi bi-star"></i>
            {% endif %}
          {% endfor %}
        </div>
        <p class="product-price">₹{{ product.price }}</p>
        <p class="product-description">{{ product.description }}</p>

        <div class="action-buttons">
          <form method="post" action="{% url 'add_to_cart' product.id %}">
            {% csrf_token %}
            <button type="submit" class="btn-glow">
              <i class="bi bi-cart-plus me-1"></i> Add to Cart
            </button>
          </form>

          <a href="{% url 'add_to_cart' product.id %}?next={% url 'checkout' %}" class="btn-outline" style="text-decoration: none; display: inline-block; padding: 12px 30px;">
            <i class="bi bi-lightning-fill me-1"></i> Buy Now
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Similar Products -->
  <div class="similar-products">
    <h3><i class="bi bi-grid me-2"></i>Similar Products</h3>
    <div class="row g-4">
      {% for item in similar_products %}
      <div class="col-md-3">
        <div class="product-card-mini">
          <img src="{{ item.image.url }}" alt="{{ item.name }}">
          <h6>{{ item.name }}</h6>
          <p>₹{{ item.price }}</p>
          <a href="{% url 'product_details_by_id' item.id %}" class="btn btn-sm btn-warning fw-semibold">View</a>
        </div>
      </div>
      {% empty %}
      <p class="text-center text-light">No similar products found.</p>
      {% endfor %}
    </div>
  </div>
</div>

{% endblock %}
